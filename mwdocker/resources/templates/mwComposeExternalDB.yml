# MediaWiki with External Database
#
# This file was generated by pymediawikidocker {{pmwdVersion}} at {{timestamp}}
# see http://wiki.bitplan.com/index.php/Pymediawikidocker
#
# Access via "http://localhost:{{port}}"
# (or "http://docker-machine ip:{{port}}" if using docker-machine)

services:

  # MediaWiki
  mw:
    container_name: "{{container_base_name}}-mw"
    user: "{{uid}}:{{gid}}"
    build: .
    restart: always
    # to be used by scripts
    environment:
      MYSQL_DATABASE: "{{wiki_id}}_wiki"
      MYSQL_USER: "{{wiki_id}}_user"
      MYSQL_PASSWORD: "{{mySQLPassword}}"
      # this was determined from the database container at generation time
      MYSQL_ROOT_PASSWORD: "{{mySQLRootPassword}}"
    ports:
      - {{port}}:80
    volumes:
      - type: {{volume_type}}
        source: {{wiki_sites}}
        target: /var/www/mediawiki/sites
      - type: volume
        source: wiki-etc
        target: /etc
      - type: volume
        source: wiki-html
        target: /var/www/html
      - type: bind
        source: {{scripts_dir}}
        target: /scripts
    # database connection
    networks:
        db: {}

networks:
    db:
        external: true        

volumes:
  wiki-etc:
    driver: local
  wiki-html:
    driver: local