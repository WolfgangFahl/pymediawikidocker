# MediaWiki with MariaDB
# 
# This file was generated by pymediawikidocker at {{timestamp}}
# see http://wiki.bitplan.com/index.php/Pymediawikidocker
#
# Access via "http://localhost:{{port}}"
#   (or "http://docker-machine ip:{{port}}" if using docker-machine)

services:

  # MySQL compatible relational database
  db:
    image: mariadb:{{mariaDBVersion}}
    container_name: {{container_base_name}}-db
    restart: always
    environment:
      MYSQL_DATABASE: wiki
      MYSQL_USER: wikiuser
      MYSQL_PASSWORD: "{{mySQLPassword}}"
      MYSQL_ROOT_PASSWORD: "{{mySQLRootPassword}}"
    ports:
      - {{sql_port}}:3306
    volumes:
      - type: {{volume_type}}           # 'volume' or 'bind'
        source: {{mysql_data}}          # volume name or host path
        target: /var/lib/mysql          # container path

  # MediaWiki
  mw:
    container_name: {{container_base_name}}-mw
    build: .
    restart: always
    command: --default-authentication-plugin=mysql_native_password
    ports:
      - {{port}}:80
    links:
      - db
    depends_on:
      - db
    volumes:
      - type: {{volume_type}}           # 'volume' or 'bind'
        source: {{wiki_www}}            # volume name or host path
        target: /var/www/               # container path
      - type: volume 
        source: wiki-etc                # volume name 
        target: /etc                    # container path
      # - type: bind
      #   source: ./LocalSettings.php   # host path
      #   target: /var/www/html/LocalSettings.php  # container path

volumes:
  wiki-etc:
    driver: local
{% if volume_type == "volume" %}
  {{mysql_data}}:
    driver: local
  {{wiki_www}}:
    driver: local
{% endif %}
